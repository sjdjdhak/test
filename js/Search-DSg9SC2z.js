var ze=Object.defineProperty,He=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var ge=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var pe=(i,e,t)=>e in i?ze(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,O=(i,e)=>{for(var t in e||(e={}))Ce.call(e,t)&&pe(i,t,e[t]);if(ge)for(var t of ge(e))Se.call(e,t)&&pe(i,t,e[t]);return i},he=(i,e)=>He(i,Ae(e));var ke=(i,e)=>{var t={};for(var s in i)Ce.call(i,s)&&e.indexOf(s)<0&&(t[s]=i[s]);if(i!=null&&ge)for(var s of ge(i))e.indexOf(s)<0&&Se.call(i,s)&&(t[s]=i[s]);return t};var ve=(i,e,t)=>pe(i,typeof e!="symbol"?e+"":e,t);var ie=(i,e,t)=>new Promise((s,l)=>{var o=$=>{try{M(t.next($))}catch(L){l(L)}},U=$=>{try{M(t.throw($))}catch(L){l(L)}},M=$=>$.done?s($.value):Promise.resolve($.value).then(o,U);M((t=t.apply(i,e)).next())});import{d as _e,f as R,H as Ue,c as oe,D as ce,a as E,g as d,h as c,w as k,u as Z,o as w,i as D,t as z,k as Ke,v as Ne,b as j,F as se,q as ae,l as X,p as qe,x as Le,m as be,j as Ve,I as Be,C as Pe}from"./index-C8EcO_R4.js";import{S as Oe}from"./SearchBox-Co8R4YEd.js";import{f as Re,E as Ie,D as je,F as We,G as Ge,e as we,H as Je,n as Ye,B as Qe,I as Ze,r as Ee,J as Xe}from"./_plugin-vue_export-helper-DAE0c8RX.js";import{a as et,E as tt}from"./el-rate-CX40KGOT.js";import{b as Fe}from"./el-input-B5lZdLQh.js";import{a as Te,b as De,E as me}from"./el-select-CaBiTLQY.js";/* empty css                        */import{N as $e}from"./NavigationCard-QWVFCIg9.js";/* empty css                          */import{E as st,a as at}from"./el-checkbox-CVNl-KV2.js";import{E as ot}from"./index-C3bBzgQX.js";import{L as rt}from"./Loading-D81gCkra.js";import{E as lt}from"./Empty-C0RpQpV3.js";import{a as Me,u as xe}from"./navigation-7vtA9nYp.js";import"./el-skeleton-item-CzrWbPsQ.js";const nt={class:"search-filters"},it={class:"filters-header"},ct={class:"filters-title"},ut={class:"filters-actions"},dt={class:"filters-content"},gt={class:"filters-grid"},ht={class:"filter-group"},vt={class:"category-option"},ft={class:"category-count"},pt={class:"filter-group"},mt={class:"filter-group"},yt={class:"rating-option"},_t={class:"rating-option"},wt={class:"rating-option"},Ct={class:"filter-group"},St={class:"filter-group"},kt={class:"filter-group"},bt={class:"advanced-options"},Et={class:"options-content"},$t={key:0,class:"quick-filters"},Lt={class:"quick-tags"},Vt={class:"filters-footer"},Rt={class:"active-filters"},It={key:0,class:"filters-count"},Ft={class:"footer-actions"},Tt=_e({__name:"SearchFilters",props:{filters:{},categories:{},popularTags:{},filteredCount:{},defaultCollapsed:{type:Boolean,default:!1}},emits:["change","apply","clear"],setup(i,{emit:e}){const t=i,s=e,l=R(t.defaultCollapsed),o=Ue(O({},t.filters)),U=[{key:"featured",label:"推荐项目",value:["featured"],field:"options"},{key:"highRating",label:"高评分",value:"4",field:"rating"},{key:"recent",label:"最近添加",value:"week",field:"timeRange"},{key:"popular",label:"热门访问",value:"1000+",field:"visitRange"}],M=oe(()=>{var n,H;let y=0;return o.categoryId&&y++,(n=o.tags)!=null&&n.length&&y++,o.rating&&y++,o.timeRange&&y++,o.visitRange&&y++,(H=o.options)!=null&&H.length&&y++,y}),$=y=>Math.floor(Math.random()*50)+1,L=()=>{s("change",O({},o))},W=()=>{l.value=!l.value},x=()=>{Object.assign(o,{categoryId:"",tags:[],rating:"",sortBy:"relevance",timeRange:"",visitRange:"",options:[]}),L(),s("clear")},A=()=>{Object.assign(o,t.filters),L()},B=()=>{s("apply",O({},o))},_=y=>{const n=o[y.field];return Array.isArray(y.value)?Array.isArray(n)&&y.value.every(H=>n.includes(H)):n===y.value},K=y=>{if(_(y))if(Array.isArray(y.value)){const n=o[y.field];o[y.field]=n.filter(H=>!y.value.includes(H))}else o[y.field]="";else if(Array.isArray(y.value)){const n=o[y.field]||[];o[y.field]=[...new Set([...n,...y.value])]}else o[y.field]=y.value;L()};return ce(()=>t.filters,y=>{Object.assign(o,y)},{deep:!0}),(y,n)=>{const H=Re,N=Ie,V=De,G=Te,ee=et,Q=at,re=st,ne=Fe,le=ot;return w(),E("div",nt,[d("div",it,[d("div",ct,[c(H,null,{default:k(()=>[c(Z(Ge))]),_:1}),n[7]||(n[7]=d("span",null,"筛选器",-1))]),d("div",ut,[c(N,{size:"small",text:"",onClick:x},{default:k(()=>n[8]||(n[8]=[D(" 清除全部 ")])),_:1,__:[8]}),c(N,{size:"small",text:"",icon:l.value?Z(je):Z(We),onClick:W},{default:k(()=>[D(z(l.value?"展开":"收起"),1)]),_:1},8,["icon"])])]),c(le,null,{default:k(()=>[Ke(d("div",dt,[d("div",gt,[d("div",ht,[n[9]||(n[9]=d("label",{class:"filter-label"},"分类",-1)),c(G,{modelValue:o.categoryId,"onUpdate:modelValue":n[0]||(n[0]=C=>o.categoryId=C),placeholder:"选择分类",clearable:"",filterable:"",onChange:L},{default:k(()=>[(w(!0),E(se,null,ae(y.categories,C=>(w(),X(V,{key:C.id,label:C.name,value:C.id},{default:k(()=>[d("div",vt,[c(H,{color:C.color},{default:k(()=>[(w(),X(qe(C.icon)))]),_:2},1032,["color"]),d("span",null,z(C.name),1),d("span",ft,"("+z($(C.id))+")",1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),d("div",pt,[n[10]||(n[10]=d("label",{class:"filter-label"},"标签",-1)),c(G,{modelValue:o.tags,"onUpdate:modelValue":n[1]||(n[1]=C=>o.tags=C),placeholder:"选择标签",multiple:"",clearable:"",filterable:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":2,onChange:L},{default:k(()=>[(w(!0),E(se,null,ae(y.popularTags,C=>(w(),X(V,{key:C.name,label:`${C.name} (${C.count})`,value:C.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),d("div",mt,[n[13]||(n[13]=d("label",{class:"filter-label"},"评分",-1)),c(G,{modelValue:o.rating,"onUpdate:modelValue":n[2]||(n[2]=C=>o.rating=C),placeholder:"选择评分",clearable:"",onChange:L},{default:k(()=>[c(V,{label:"全部评分",value:""}),c(V,{label:"5星",value:"5"},{default:k(()=>[d("div",yt,[c(ee,{"model-value":5,disabled:"","show-score":""})])]),_:1}),c(V,{label:"4星以上",value:"4"},{default:k(()=>[d("div",_t,[c(ee,{"model-value":4,disabled:"","show-score":""}),n[11]||(n[11]=d("span",null,"以上",-1))])]),_:1}),c(V,{label:"3星以上",value:"3"},{default:k(()=>[d("div",wt,[c(ee,{"model-value":3,disabled:"","show-score":""}),n[12]||(n[12]=d("span",null,"以上",-1))])]),_:1})]),_:1},8,["modelValue"])]),d("div",Ct,[n[14]||(n[14]=d("label",{class:"filter-label"},"排序",-1)),c(G,{modelValue:o.sortBy,"onUpdate:modelValue":n[3]||(n[3]=C=>o.sortBy=C),onChange:L},{default:k(()=>[c(V,{label:"相关度",value:"relevance"}),c(V,{label:"最新添加",value:"createTime"}),c(V,{label:"访问量",value:"visitCount"}),c(V,{label:"评分",value:"rating"}),c(V,{label:"名称",value:"title"})]),_:1},8,["modelValue"])]),d("div",St,[n[15]||(n[15]=d("label",{class:"filter-label"},"添加时间",-1)),c(G,{modelValue:o.timeRange,"onUpdate:modelValue":n[4]||(n[4]=C=>o.timeRange=C),placeholder:"选择时间范围",clearable:"",onChange:L},{default:k(()=>[c(V,{label:"全部时间",value:""}),c(V,{label:"最近一周",value:"week"}),c(V,{label:"最近一月",value:"month"}),c(V,{label:"最近三月",value:"quarter"}),c(V,{label:"最近一年",value:"year"})]),_:1},8,["modelValue"])]),d("div",kt,[n[16]||(n[16]=d("label",{class:"filter-label"},"访问量",-1)),c(G,{modelValue:o.visitRange,"onUpdate:modelValue":n[5]||(n[5]=C=>o.visitRange=C),placeholder:"选择访问量范围",clearable:"",onChange:L},{default:k(()=>[c(V,{label:"全部",value:""}),c(V,{label:"1000+ 次",value:"1000+"}),c(V,{label:"500-1000 次",value:"500-1000"}),c(V,{label:"100-500 次",value:"100-500"}),c(V,{label:"100 次以下",value:"0-100"})]),_:1},8,["modelValue"])])]),d("div",bt,[n[21]||(n[21]=d("div",{class:"options-title"},[d("span",null,"高级选项")],-1)),d("div",Et,[c(re,{modelValue:o.options,"onUpdate:modelValue":n[6]||(n[6]=C=>o.options=C),onChange:L},{default:k(()=>[c(Q,{label:"featured"},{default:k(()=>n[17]||(n[17]=[D("仅显示推荐项目")])),_:1,__:[17]}),c(Q,{label:"active"},{default:k(()=>n[18]||(n[18]=[D("仅显示启用项目")])),_:1,__:[18]}),c(Q,{label:"hasIcon"},{default:k(()=>n[19]||(n[19]=[D("有图标的项目")])),_:1,__:[19]}),c(Q,{label:"hasDescription"},{default:k(()=>n[20]||(n[20]=[D("有描述的项目")])),_:1,__:[20]})]),_:1},8,["modelValue"])])]),U.length>0?(w(),E("div",$t,[n[22]||(n[22]=d("div",{class:"quick-title"},"快速筛选",-1)),d("div",Lt,[(w(),E(se,null,ae(U,C=>c(ne,{key:C.key,type:_(C)?"primary":"info",class:"quick-tag",onClick:ue=>K(C)},{default:k(()=>[D(z(C.label),1)]),_:2},1032,["type","onClick"])),64))])])):j("",!0),d("div",Vt,[d("div",Rt,[M.value>0?(w(),E("span",It," 已应用 "+z(M.value)+" 个筛选条件 ",1)):j("",!0)]),d("div",Ft,[c(N,{onClick:A},{default:k(()=>n[23]||(n[23]=[D("重置")])),_:1,__:[23]}),c(N,{type:"primary",onClick:B},{default:k(()=>[D(" 应用筛选 ("+z(y.filteredCount)+") ",1)]),_:1})])])],512),[[Ne,!l.value]])]),_:1})])}}}),Dt=we(Tt,[["__scopeId","data-v-f8e5048f"]]);class Mt{constructor(e="ai_nav_",t=!1){ve(this,"prefix");ve(this,"storage");this.prefix=e,this.storage=t?window.sessionStorage:window.localStorage}set(e,t,s={}){try{const l={value:t,timestamp:Date.now(),expires:s.expires?Date.now()+s.expires:void 0};let o=JSON.stringify(l);return s.compress&&(o=this.compress(o)),s.encrypt&&(o=this.encrypt(o)),this.storage.setItem(this.getKey(e),o),!0}catch(l){return console.error("Storage set error:",l),!1}}get(e,t){try{const s=this.storage.getItem(this.getKey(e));if(!s)return t;let l=s;this.isEncrypted(l)&&(l=this.decrypt(l)),this.isCompressed(l)&&(l=this.decompress(l));const o=JSON.parse(l);return o.expires&&Date.now()>o.expires?(this.remove(e),t):o.value}catch(s){return console.error("Storage get error:",s),t}}remove(e){try{return this.storage.removeItem(this.getKey(e)),!0}catch(t){return console.error("Storage remove error:",t),!1}}clear(){try{return this.getKeys().forEach(t=>{this.storage.removeItem(t)}),!0}catch(e){return console.error("Storage clear error:",e),!1}}has(e){return this.storage.getItem(this.getKey(e))!==null}getKeys(){const e=[];for(let t=0;t<this.storage.length;t++){const s=this.storage.key(t);s&&s.startsWith(this.prefix)&&e.push(s)}return e}getSize(){let e=0;return this.getKeys().forEach(s=>{const l=this.storage.getItem(s);l&&(e+=l.length)}),e}getUsage(){const e=this.getSize(),t=this.getStorageLimit(),s=Math.round(e/t*100);return{used:e,total:t,percentage:s}}cleanup(){let e=0;return this.getKeys().forEach(s=>{try{const l=this.storage.getItem(s);if(l){const o=JSON.parse(l);o.expires&&Date.now()>o.expires&&(this.storage.removeItem(s),e++)}}catch(l){this.storage.removeItem(s),e++}}),e}export(){const e={};return this.getKeys().forEach(s=>{const l=s.replace(this.prefix,""),o=this.get(l);o!==void 0&&(e[l]=o)}),e}import(e,t={}){try{return Object.entries(e).forEach(([s,l])=>{this.set(s,l,t)}),!0}catch(s){return console.error("Storage import error:",s),!1}}getKey(e){return`${this.prefix}${e}`}getStorageLimit(){return 5*1024*1024}compress(e){return`__COMPRESSED__${btoa(e)}`}decompress(e){return this.isCompressed(e)?atob(e.replace("__COMPRESSED__","")):e}isCompressed(e){return e.startsWith("__COMPRESSED__")}encrypt(e){return`__ENCRYPTED__${btoa(e)}`}decrypt(e){return this.isEncrypted(e)?atob(e.replace("__ENCRYPTED__","")):e}isEncrypted(e){return e.startsWith("__ENCRYPTED__")}}class xt{constructor(){ve(this,"storage",new Mt("ai_nav_prefs_"))}setTheme(e){this.storage.set("theme",e)}getTheme(){return this.storage.get("theme","light")||"light"}setLanguage(e){this.storage.set("language",e)}getLanguage(){return this.storage.get("language","zh-CN")||"zh-CN"}setViewMode(e){this.storage.set("viewMode",e)}getViewMode(){return this.storage.get("viewMode","grid")||"grid"}setSearchHistory(e){this.storage.set("searchHistory",e,{expires:7*24*60*60*1e3})}getSearchHistory(){return this.storage.get("searchHistory",[])||[]}addSearchHistory(e){const t=this.getSearchHistory(),s=[e,...t.filter(l=>l!==e)].slice(0,10);this.setSearchHistory(s)}clearSearchHistory(){this.storage.remove("searchHistory")}setFavorites(e){this.storage.set("favorites",e)}getFavorites(){return this.storage.get("favorites",[])||[]}addFavorite(e){const t=this.getFavorites();t.includes(e)||this.setFavorites([...t,e])}removeFavorite(e){const t=this.getFavorites();this.setFavorites(t.filter(s=>s!==e))}isFavorite(e){return this.getFavorites().includes(e)}}const Y=new xt,ye={truncate(i,e,t="..."){return i.length<=e?i:i.slice(0,e-t.length)+t},capitalize(i){return i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()},camelCase(i){return i.replace(/(?:^\w|[A-Z]|\b\w)/g,(e,t)=>t===0?e.toLowerCase():e.toUpperCase()).replace(/\s+/g,"")},kebabCase(i){return i.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/\s+/g,"-").toLowerCase()},stripHtml(i){return i.replace(/<[^>]*>/g,"")},highlight(i,e,t="highlight"){if(!e)return i;const s=new RegExp(`(${e})`,"gi");return i.replace(s,`<span class="${t}">$1</span>`)},randomString(i=8){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let s=0;s<i;s++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},generateId(i=""){const e=Date.now().toString(36),t=Math.random().toString(36).substr(2,5);return`${i}${e}${t}`},similarity(i,e){const t=i.length>e.length?i:e,s=i.length>e.length?e:i;if(t.length===0)return 1;const l=this.levenshteinDistance(t,s);return(t.length-l)/t.length},levenshteinDistance(i,e){const t=[];for(let s=0;s<=e.length;s++)t[s]=[s];for(let s=0;s<=i.length;s++)t[0][s]=s;for(let s=1;s<=e.length;s++)for(let l=1;l<=i.length;l++)e.charAt(s-1)===i.charAt(l-1)?t[s][l]=t[s-1][l-1]:t[s][l]=Math.min(t[s-1][l-1]+1,t[s][l-1]+1,t[s-1][l]+1);return t[e.length][i.length]}},zt={class:"search-results"},Ht={class:"results-header"},At={class:"results-info"},Ut={class:"results-title"},Kt={key:0,class:"keyword"},Nt={class:"results-meta"},qt={class:"results-count"},Bt={key:0,class:"search-time"},Pt={class:"results-actions"},Ot={key:0,class:"results-filters"},jt={key:1,class:"search-suggestions"},Wt={class:"suggestions-list"},Gt={key:2,class:"results-loading"},Jt={key:3,class:"results-content"},Yt={key:0,class:"results-grid"},Qt={key:1,class:"results-list"},Zt=["onClick"],Xt={class:"item-icon"},es=["src","alt"],ts={class:"item-content"},ss={class:"item-header"},as=["innerHTML"],os={class:"item-meta"},rs={key:1,class:"item-rating"},ls=["innerHTML"],ns={class:"item-footer"},is={class:"item-url"},cs={class:"item-tags"},us={key:0,class:"more-tags"},ds={class:"item-actions"},gs={key:2,class:"results-pagination"},hs={key:4,class:"results-empty"},vs={key:5,class:"results-recommendations"},fs={class:"recommendations-grid"},ps=_e({__name:"SearchResults",props:{keyword:{default:""},filters:{default:()=>({categories:[],tags:[],rating:0,featured:!1})},showFilters:{type:Boolean,default:!0},autoSearch:{type:Boolean,default:!0}},emits:["update:keyword","update:filters","item-click","clear-search"],setup(i,{emit:e}){const t=i,s=e,l=Ve(),o=Me(),U=xe(),M=R(!1),$=R([]),L=R(0),W=R(0),x=R(1),A=R(20),B=R("relevance"),_=R("grid"),K=R([]),y=R([]),n=oe(()=>U.flatCategories),H=oe({get:()=>t.filters,set:a=>s("update:filters",a)}),N=()=>ie(this,null,function*(){if(!t.keyword.trim()){$.value=[],L.value=0;return}M.value=!0;const a=Date.now();try{yield new Promise(T=>setTimeout(T,300));const r=o.navigations,p=V(r,t.keyword,H.value),F=G(p,B.value),b=(x.value-1)*A.value,I=b+A.value;$.value=F.slice(b,I),L.value=F.length,W.value=Date.now()-a,ee(t.keyword,r),Q(p),Y.addSearchHistory(t.keyword)}catch(r){console.error("Search error:",r),me.error("搜索失败，请重试")}finally{M.value=!1}}),V=(a,r,p)=>{const F=[];return a.forEach(b=>{var J,f;const I=n.value.find(P=>P.id===b.categoryId),T=he(O({},b),{category:I});let q=0;b.title.toLowerCase().includes(r.toLowerCase())&&(q+=10),(J=b.description)!=null&&J.toLowerCase().includes(r.toLowerCase())&&(q+=5),(f=b.tags)!=null&&f.some(P=>P.toLowerCase().includes(r.toLowerCase()))&&(q+=3),I!=null&&I.name.toLowerCase().includes(r.toLowerCase())&&(q+=2),!(p.categories.length>0&&!p.categories.includes(b.categoryId))&&(p.tags.length>0&&!p.tags.some(P=>{var te;return(te=b.tags)==null?void 0:te.includes(P)})||p.rating>0&&(b.rating||0)<p.rating||p.featured&&!b.featured||q>0&&(T.relevanceScore=q,F.push(T)))}),F},G=(a,r)=>[...a].sort((p,F)=>{switch(r){case"relevance":return(F.relevanceScore||0)-(p.relevanceScore||0);case"time":return new Date(F.updateTime).getTime()-new Date(p.updateTime).getTime();case"popularity":return(F.visitCount||0)-(p.visitCount||0);case"rating":return(F.rating||0)-(p.rating||0);default:return 0}}),ee=(a,r)=>{const p=new Set;r.forEach(F=>{var I;F.title.toLowerCase().split(/\s+/).forEach(T=>{T.includes(a.toLowerCase())&&T!==a.toLowerCase()&&p.add(T)}),(I=F.tags)==null||I.forEach(T=>{T.toLowerCase().includes(a.toLowerCase())&&T!==a&&p.add(T)})}),K.value=Array.from(p).slice(0,5)},Q=a=>{const r=[...new Set(a.map(b=>b.categoryId))],F=o.navigations.filter(b=>r.includes(b.categoryId)&&!a.some(I=>I.id===b.id)).sort((b,I)=>(I.rating||0)-(b.rating||0)).slice(0,6).map(b=>he(O({},b),{category:n.value.find(I=>I.id===b.categoryId)}));y.value=F},re=(a,r)=>!r||!a?a:ye.highlight(a,r,"search-highlight"),ne=()=>{N()},le=a=>{s("update:filters",a)},C=a=>{x.value=a,N()},ue=a=>{A.value=a,x.value=1,N()},fe=a=>{s("update:keyword",a)},de=a=>{s("item-click",a),o.incrementVisitCount(a.id)},h=a=>{window.open(a.url,"_blank"),o.incrementVisitCount(a.id)},m=a=>{const r=a.target;r.style.display="none"},v=a=>Y.isFavorite(a),u=a=>{v(a.id)?(Y.removeFavorite(a.id),me.success("已取消收藏")):(Y.addFavorite(a.id),me.success("已添加到收藏"))},g=()=>{s("clear-search")},S=()=>{l.push("/")};return ce(()=>t.keyword,()=>{t.autoSearch&&(x.value=1,N())},{immediate:!0}),ce(()=>t.filters,()=>{t.autoSearch&&(x.value=1,N())},{deep:!0}),Le(()=>{_.value=Y.getViewMode()}),ce(_,a=>{Y.setViewMode(a)}),(a,r)=>{const p=De,F=Te,b=Ie,I=Je,T=Fe,q=Re,J=tt;return w(),E("div",zt,[d("div",Ht,[d("div",At,[d("h3",Ut,[r[5]||(r[5]=D(" 搜索结果 ")),a.keyword?(w(),E("span",Kt,' "'+z(a.keyword)+'" ',1)):j("",!0)]),d("div",Nt,[d("span",qt," 找到 "+z(L.value)+" 个结果 ",1),W.value?(w(),E("span",Bt," (用时 "+z(W.value)+"ms) ",1)):j("",!0)])]),d("div",Pt,[c(F,{modelValue:B.value,"onUpdate:modelValue":r[0]||(r[0]=f=>B.value=f),placeholder:"排序方式",style:{width:"120px"},onChange:ne},{default:k(()=>[c(p,{label:"相关度",value:"relevance"}),c(p,{label:"时间",value:"time"}),c(p,{label:"热度",value:"popularity"}),c(p,{label:"评分",value:"rating"})]),_:1},8,["modelValue"]),c(I,null,{default:k(()=>[c(b,{type:_.value==="grid"?"primary":"default",icon:Z(Ye),onClick:r[1]||(r[1]=f=>_.value="grid")},null,8,["type","icon"]),c(b,{type:_.value==="list"?"primary":"default",icon:Z(Qe),onClick:r[2]||(r[2]=f=>_.value="list")},null,8,["type","icon"])]),_:1})])]),a.showFilters?(w(),E("div",Ot,[c(Dt,{filters:H.value,categories:n.value,"onUpdate:filters":le},null,8,["filters","categories"])])):j("",!0),K.value.length>0?(w(),E("div",jt,[r[6]||(r[6]=d("div",{class:"suggestions-title"},"您是否要找：",-1)),d("div",Wt,[(w(!0),E(se,null,ae(K.value,f=>(w(),X(T,{key:f,class:"suggestion-tag",onClick:P=>fe(f)},{default:k(()=>[D(z(f),1)]),_:2},1032,["onClick"]))),128))])])):j("",!0),M.value?(w(),E("div",Gt,[c(rt,{type:"skeleton",count:6})])):$.value.length>0?(w(),E("div",Jt,[_.value==="grid"?(w(),E("div",Yt,[(w(!0),E(se,null,ae($.value,f=>(w(),X($e,{key:f.id,navigation:f,keyword:a.keyword,onClick:P=>de(f)},null,8,["navigation","keyword","onClick"]))),128))])):(w(),E("div",Qt,[(w(!0),E(se,null,ae($.value,f=>{var P;return w(),E("div",{key:f.id,class:"result-item",onClick:te=>de(f)},[d("div",Xt,[f.icon?(w(),E("img",{key:0,src:f.icon,alt:f.title,onError:m},null,40,es)):(w(),X(q,{key:1,size:"24"},{default:k(()=>[c(Z(Ze))]),_:1}))]),d("div",ts,[d("div",ss,[d("h4",{class:"item-title",innerHTML:re(f.title,a.keyword)},null,8,as),d("div",os,[f.category?(w(),X(T,{key:0,color:f.category.color,size:"small",effect:"light"},{default:k(()=>[D(z(f.category.name),1)]),_:2},1032,["color"])):j("",!0),f.rating?(w(),E("span",rs,[c(q,null,{default:k(()=>[c(Z(Ee))]),_:1}),D(" "+z(f.rating),1)])):j("",!0)])]),d("div",{class:"item-description",innerHTML:re(f.description,a.keyword)},null,8,ls),d("div",ns,[d("div",is,z(f.url),1),d("div",cs,[(w(!0),E(se,null,ae((P=f.tags)==null?void 0:P.slice(0,3),te=>(w(),X(T,{key:te,size:"small",type:"info",effect:"plain"},{default:k(()=>[D(z(te),1)]),_:2},1024))),128)),f.tags&&f.tags.length>3?(w(),E("span",us," +"+z(f.tags.length-3),1)):j("",!0)])])]),d("div",ds,[c(b,{size:"small",type:"primary",onClick:be(te=>h(f),["stop"])},{default:k(()=>r[7]||(r[7]=[D(" 访问 ")])),_:2,__:[7]},1032,["onClick"]),c(b,{size:"small",icon:v(f.id)?Z(Xe):Z(Ee),onClick:be(te=>u(f),["stop"])},null,8,["icon","onClick"])])],8,Zt)}),128))])),L.value>A.value?(w(),E("div",gs,[c(J,{"current-page":x.value,"onUpdate:currentPage":r[3]||(r[3]=f=>x.value=f),"page-size":A.value,"onUpdate:pageSize":r[4]||(r[4]=f=>A.value=f),total:L.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ue,onCurrentChange:C},null,8,["current-page","page-size","total"])])):j("",!0)])):(w(),E("div",hs,[c(lt,{type:"search",title:a.keyword?"未找到相关结果":"请输入搜索关键词",description:a.keyword?`没有找到与 '${a.keyword}' 相关的内容`:"在上方搜索框中输入关键词开始搜索"},{actions:k(()=>[c(b,{onClick:g},{default:k(()=>r[8]||(r[8]=[D("清空搜索")])),_:1,__:[8]}),c(b,{type:"primary",onClick:S},{default:k(()=>r[9]||(r[9]=[D(" 浏览全部 ")])),_:1,__:[9]})]),_:1},8,["title","description"])])),y.value.length>0?(w(),E("div",vs,[r[10]||(r[10]=d("h4",{class:"recommendations-title"},"相关推荐",-1)),d("div",fs,[(w(!0),E(se,null,ae(y.value,f=>(w(),X($e,{key:f.id,navigation:f,size:"small",onClick:P=>de(f)},null,8,["navigation","onClick"]))),128))])])):j("",!0)])}}}),ms=we(ps,[["__scopeId","data-v-05448736"]]),ys=Be("search",()=>{const i=R(""),e=R([]),t=R([]),s=R([]),l=R([]),o=R(!1),U=R(0),M=R(0),$=R({categories:[],tags:[],rating:0,featured:!1}),L=Me(),W=xe(),x=oe(()=>e.value.length>0),A=oe(()=>t.value.slice(0,10).map(h=>h.keyword)),B=oe(()=>{const h=new Map;return L.navigations.forEach(m=>{var v;(v=m.tags)==null||v.forEach(u=>{h.set(u,(h.get(u)||0)+1)})}),Array.from(h.entries()).sort((m,v)=>v[1]-m[1]).slice(0,20).map(([m])=>m)}),_=oe(()=>{const h={totalSearches:t.value.length,uniqueKeywords:new Set(t.value.map(m=>m.keyword)).size,averageResults:0,mostSearched:""};if(t.value.length>0){h.averageResults=t.value.reduce((u,g)=>u+g.resultCount,0)/t.value.length;const m=new Map;t.value.forEach(u=>{m.set(u.keyword,(m.get(u.keyword)||0)+1)});const v=Array.from(m.entries()).sort((u,g)=>g[1]-u[1])[0];v&&(h.mostSearched=v[0])}return h}),K=(h,m)=>ie(void 0,null,function*(){if(!h.trim())return ee(),[];o.value=!0,i.value=h.trim(),m&&($.value=O(O({},$.value),m));const v=Date.now();try{const u=L.navigations,g=W.flatCategories,S=y(u,g,h,$.value);return U.value=Date.now()-v,e.value=S,M.value=S.length,N(h,S.length),H(h,u,g),S}catch(u){throw console.error("Search error:",u),u}finally{o.value=!1}}),y=(h,m,v,u)=>{const g=[],S=v.toLowerCase();return h.forEach(a=>{var T,q;const r=m.find(J=>J.id===a.categoryId);let p=0,F=a.title,b=a.description||"";a.title.toLowerCase().includes(S)&&(p+=10,F=ye.highlight(a.title,v,"search-highlight")),a.title.toLowerCase()===S&&(p+=20),a.title.toLowerCase().startsWith(S)&&(p+=15),(T=a.description)!=null&&T.toLowerCase().includes(S)&&(p+=5,b=ye.highlight(a.description,v,"search-highlight"));const I=((q=a.tags)==null?void 0:q.filter(J=>J.toLowerCase().includes(S)))||[];I.length>0&&(p+=I.length*3,I.some(J=>J.toLowerCase()===S)&&(p+=10)),r!=null&&r.name.toLowerCase().includes(S)&&(p+=2),a.url.toLowerCase().includes(S)&&(p+=1),n(a,r,u)&&p>0&&g.push(he(O({},a),{category:r,relevanceScore:p,highlightTitle:F,highlightDescription:b}))}),g.sort((a,r)=>(r.relevanceScore||0)-(a.relevanceScore||0))},n=(h,m,v)=>{if(v.categories.length>0&&!v.categories.includes(h.categoryId)||v.tags.length>0&&!v.tags.some(g=>{var S;return(S=h.tags)==null?void 0:S.includes(g)})||v.rating>0&&(h.rating||0)<v.rating||v.featured&&!h.featured)return!1;if(v.dateRange){const[u,g]=v.dateRange,S=new Date(h.createTime),a=new Date(u),r=new Date(g);if(S<a||S>r)return!1}return!0},H=(h,m,v)=>{const u=new Map,g=h.toLowerCase();m.forEach(S=>{S.title.toLowerCase().split(/\s+/).forEach(r=>{if(r.includes(g)&&r!==g&&r.length>2){const p=u.get(r);p?p.count++:u.set(r,{text:r,type:"keyword",count:1})}})}),m.forEach(S=>{var a;(a=S.tags)==null||a.forEach(r=>{if(r.toLowerCase().includes(g)&&r.toLowerCase()!==g){const p=u.get(r);p?p.count++:u.set(r,{text:r,type:"tag",count:1})}})}),v.forEach(S=>{S.name.toLowerCase().includes(g)&&S.name.toLowerCase()!==g&&u.set(S.name,{text:S.name,type:"category",count:1})}),l.value=Array.from(u.values()).sort((S,a)=>a.count-S.count).slice(0,8)},N=(h,m)=>{const v={keyword:h,timestamp:Date.now(),resultCount:m};t.value=t.value.filter(u=>u.keyword!==h),t.value.unshift(v),t.value.length>100&&(t.value=t.value.slice(0,100)),Y.setSearchHistory(t.value)},V=()=>{t.value=[],Y.clearSearchHistory()},G=h=>{t.value=t.value.filter(m=>m.keyword!==h),Y.setSearchHistory(t.value)},ee=()=>{e.value=[],M.value=0,i.value="",U.value=0},Q=h=>{$.value=O(O({},$.value),h),i.value&&K(i.value)},re=()=>{$.value={categories:[],tags:[],rating:0,featured:!1}},ne=h=>{if(!h.trim())return[];const m=h.toLowerCase(),v=[];t.value.forEach(g=>{g.keyword.toLowerCase().includes(m)&&v.push({text:g.keyword,type:"keyword",count:1})}),s.value.forEach(g=>{g.toLowerCase().includes(m)&&v.push({text:g,type:"keyword",count:1})}),W.flatCategories.forEach(g=>{g.name.toLowerCase().includes(m)&&v.push({text:g.name,type:"category",count:1})}),B.value.forEach(g=>{g.toLowerCase().includes(m)&&v.push({text:g,type:"tag",count:1})});const u=new Map;return v.forEach(g=>{u.has(g.text)||u.set(g.text,g)}),Array.from(u.values()).slice(0,10)},le=()=>ie(void 0,null,function*(){try{s.value=["ChatGPT","AI绘画","代码生成","文本转语音","图像识别","机器学习","自然语言处理","计算机视觉"]}catch(h){console.error("Load hot searches error:",h)}}),C=()=>{const h=Y.getSearchHistory();h&&(t.value=h),le()},ue=h=>ie(void 0,null,function*(){const S=h,{keyword:m="",sortBy:v="relevance"}=S,u=ke(S,["keyword","sortBy"]);Q(u);const g=yield K(m);return v!=="relevance"&&(e.value=fe(g,v)),e.value}),fe=(h,m)=>[...h].sort((v,u)=>{switch(m){case"time":return new Date(u.updateTime).getTime()-new Date(v.updateTime).getTime();case"popularity":return(u.visitCount||0)-(v.visitCount||0);case"rating":return(u.rating||0)-(v.rating||0);default:return(u.relevanceScore||0)-(v.relevanceScore||0)}});return{currentKeyword:i,searchResults:e,searchHistory:t,hotSearches:s,suggestions:l,isSearching:o,searchTime:U,totalResults:M,currentFilters:$,hasResults:x,recentSearches:A,popularTags:B,searchStats:_,search:K,clearHistory:V,removeFromHistory:G,clearResults:ee,updateFilters:Q,resetFilters:re,getSearchSuggestions:ne,loadHotSearches:le,initializeStore:C,advancedSearch:ue,getSearchAnalytics:()=>{const h={totalSearches:t.value.length,uniqueKeywords:new Set(t.value.map(m=>m.keyword)).size,averageResults:0,topKeywords:[],searchTrends:[],noResultsKeywords:[]};if(t.value.length>0){h.averageResults=t.value.reduce((u,g)=>u+g.resultCount,0)/t.value.length;const m=new Map;t.value.forEach(u=>{m.set(u.keyword,(m.get(u.keyword)||0)+1)}),h.topKeywords=Array.from(m.entries()).map(([u,g])=>({keyword:u,count:g})).sort((u,g)=>g.count-u.count).slice(0,10),h.noResultsKeywords=t.value.filter(u=>u.resultCount===0).map(u=>u.keyword).slice(0,10);const v=new Map;t.value.forEach(u=>{const g=new Date(u.timestamp).toISOString().split("T")[0];v.set(g,(v.get(g)||0)+1)}),h.searchTrends=Array.from(v.entries()).map(([u,g])=>({date:u,count:g})).sort((u,g)=>u.date.localeCompare(g.date)).slice(-30)}return h}}}),_s={class:"search-page"},ws={class:"search-header"},Cs={class:"search-container"},Ss={class:"search-content"},ks={class:"container"},bs=_e({__name:"Search",setup(i){const e=Pe(),t=Ve(),s=ys(),l=R(""),o=R({categories:[],tags:[],rating:0,featured:!1}),U=_=>{l.value=_,x()},M=_=>{l.value=_,A()},$=_=>{o.value=_,x()},L=_=>{console.log("Item clicked:",_)},W=()=>{l.value="",o.value={categories:[],tags:[],rating:0,featured:!1},t.push("/search")},x=()=>{l.value.trim()&&(s.search(l.value,o.value),A())},A=()=>{const _={};l.value&&(_.q=l.value),o.value.categories.length>0&&(_.categories=o.value.categories.join(",")),o.value.tags.length>0&&(_.tags=o.value.tags.join(",")),o.value.rating>0&&(_.rating=o.value.rating),o.value.featured&&(_.featured="1"),t.replace({query:_})},B=()=>{const _=e.query;_.q&&(l.value=_.q),_.categories&&(o.value.categories=_.categories.split(",")),_.tags&&(o.value.tags=_.tags.split(",")),_.rating&&(o.value.rating=Number(_.rating)),_.featured&&(o.value.featured=_.featured==="1")};return Le(()=>{B(),l.value&&x(),s.initializeStore()}),ce(()=>e.query,()=>{B(),l.value&&x()},{deep:!0}),(_,K)=>(w(),E("div",_s,[d("div",ws,[d("div",Cs,[c(Oe,{modelValue:l.value,"onUpdate:modelValue":K[0]||(K[0]=y=>l.value=y),"auto-focus":!0,"show-suggestions":!0,onSearch:U},null,8,["modelValue"])])]),d("div",Ss,[d("div",ks,[c(ms,{keyword:l.value,filters:o.value,"show-filters":!0,"onUpdate:keyword":M,"onUpdate:filters":$,onItemClick:L,onClearSearch:W},null,8,["keyword","filters"])])])]))}}),Ns=we(bs,[["__scopeId","data-v-b250e196"]]);export{Ns as default};
